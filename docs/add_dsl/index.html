<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<title>Add a new DSL</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=description content="How to add a new Domain Specific Language to Kaoto.">
<meta name=author content="KaotoIO team">
<meta name=generator content="Hugo 0.92.1">
<style>:root{--primary-color:#41228e}</style>
<link rel=stylesheet href=https://kaoto.io/plugins/bootstrap/bootstrap.min.css>
<link rel=stylesheet href=https://kaoto.io/plugins/slick/slick.css>
<link rel=stylesheet href=https://kaoto.io/plugins/themify-icons/themify-icons.css>
<link rel=stylesheet href=https://kaoto.io/css/style.min.css media=screen>
<link rel="shortcut icon" href=https://kaoto.io/images/favicon.ico type=image/x-icon>
<link rel=icon href=https://kaoto.io/images/favicon.ico type=image/x-icon>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BP1PVX7HSK"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BP1PVX7HSK')</script>
</head>
<body>
<div class=preloader>
<img src=/images/preloader.gif alt=preloader>
</div>
<header class="navigation fixed-top">
<nav class="navbar navbar-expand-lg navbar-dark">
<a class=navbar-brand href=https://kaoto.io/>
<h3 class="text-white font-tertiary">Free Libre Open Source Integration Editor</h3>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse text-center" id=navigation>
<ul class="navbar-nav ml-auto">
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/></a>
</li>
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/about>About</a>
</li>
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/blog>Blog</a>
</li>
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/quickstart>Quick Start</a>
</li>
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/docs>Docs</a>
</li>
<li class=nav-item>
<a class=nav-link href=https://kaoto.io/portfolio>Use Cases</a>
</li>
</ul>
</div>
</nav>
</header>
<section class="page-title bg-primary position-relative overflow-hidden">
<div class=container>
<div class=row>
<div class="col-12 text-center">
<h1 class="text-white font-tertiary">Add a new DSL</h1>
</div>
</div>
</div>
<img src=/images/illustrations/page-title.png alt=illustrations class="bg-shape-1 w-100">
<img src=/images/illustrations/leaf-pink-round.svg alt=illustrations class=bg-shape-2>
<img src=/images/illustrations/dots-cyan.svg alt=illustrations class=bg-shape-3>
<img src=/images/illustrations/leaf-orange.svg alt=illustrations class=bg-shape-4>
<img src=/images/illustrations/leaf-yellow.svg alt=illustrations class=bg-shape-5>
<img src=/images/illustrations/dots-group-cyan.svg alt=illustrations class=bg-shape-6>
<img src=/images/illustrations/leaf-cyan-lg.svg alt=illustrations class=bg-shape-7>
</section>
<section class=section>
<div class=container>
<div class="row justify-content-center">
<div class="col-lg-9 text-center mb-4">
<img src=https://kaoto.io/images/portfolio/screenshot-03.png alt="Add a new DSL" class="img-fluid rounded mb-4">
<p class=font-secondary>Published on 01 Jan 2021 by <span class=text-primary>KaotoIO team</span></p>
</div>
<div class=col-lg-9>
<div class=content>
<p>Kaoto frontend is agnostic of the DSL (Domain Specific Language) used, so to add support for a new DSL we just have to implement the specific endpoints on the <a href=https://kaotoio.github.io/kaoto-backend/api/index.html>API</a>.</p>
<p>To properly deploy the workflows, Kaoto is expecting the integration to be deployed via a <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/>CustomResourceDefinition (CRD)</a> as <a href=https://camel.apache.org/camel-k/>Camel-K</a> does. You can use other kinds of source code and build integrations with them, but they won&rsquo;t be deployable via Kaoto.</p>
<h2 id=implementation>Implementation</h2>
<p>You can use the <a href=https://github.com/KaotoIO/kaoto-backend/tree/main/kamelet-support>kamelet-support</a> project as an example.</p>
<p>You need to create a new Java Maven project that <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/api/pom.xml#L88-L92>will be added as dependency on the API project</a>. You will need to add the <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/kamelet-support/pom.xml#L14-L28>model, catalog and services-interfaces dependencies</a> in your project.</p>
<p>Your project has to provide implementations for one or more the following services:</p>
<h3 id=deploymentgeneratorservice>DeploymentGeneratorService</h3>
<p>This service will translate from the JSON list of steps used by the frontend to visualize graphically the workflow to the source code. By implementing this service, you give Kaoto the ability to &ldquo;translate&rdquo; from graphical to source code.</p>
<p><img src=/images/docs/kaoto-backend-overview-crd.svg alt="From steps to code" title="From steps to code"></p>
<p>Your implementation must be <code>@ApplicationScoped</code>:</p>
<pre tabindex=0><code>@ApplicationScoped
public class KameletBindingDeploymentGeneratorService
        implements DeploymentGeneratorService {

</code></pre><p>The <code>identifier()</code> should return a unique string that will be useful to correlate the generated CRD with the type of workflow we are generating.</p>
<pre tabindex=0><code>    public String identifier() {
        return &quot;KameletBinding&quot;;
    }
    
</code></pre><p>The <code>getKinds()</code> must return what steps are this CRD compatible with. Kaoto will try to apply all DeploymentGeneratorServices on all the calls unless we explicitly ask for a specific source code output. The <code>getKinds</code> function is a quick check to know if we should apply this implementation when Kaoto is requested to output source codes.</p>
<pre tabindex=0><code>
    @Override
    public List&lt;String&gt; getKinds() {
        return Arrays.asList(new String[]{CAMEL_CONNECTOR, KAMELET});
    }

</code></pre><p>Then, we need to implement the <code>parse(...)</code> function that will return the CRD content based on the list of steps and a map of metadata.</p>
<pre tabindex=0><code>    @Override
    public String parse(List&lt;Step&gt; steps, Map&lt;String, Object&gt; metadata) {
        if (!appliesTo(steps)) {
            return &quot;&quot;; //someone tried to apply this service to the wrong list of steps
        }
         ...
    }

</code></pre><p>Finally, the <code>appliesTo(...)</code> function will be used to decide if this service can be applied to the list of steps. Note that this <code>appliesTo</code> function is the one that decides if you will be able to generate the source code or not. If this function returns <code>true</code>, the function <code>parse</code> must return valid source code.</p>
<h3 id=stepparserservice>StepParserService</h3>
<p>This service will do the reverse operation as DeploymentGeneratorService: given a CRD, return the list of steps associated to it. By implementing this service, you give Kaoto the ability to &ldquo;translate&rdquo; from the source code to graphic editing.</p>
<p><img src=/images/docs/kaoto-backend-overview-steps.svg alt="From code to steps" title="From code to steps"></p>
<p>As the previous one, it must have the <code>@ApplicationScoped</code> annotation.</p>
<pre tabindex=0><code>@ApplicationScoped
public class KameletBindingStepParserService
        implements StepParserService&lt;Step&gt; {
</code></pre><p>You may want to inject a catalog step.</p>
<pre tabindex=0><code>    private StepCatalog catalog;

    @Inject
    public void setCatalog(final StepCatalog catalog) {
        this.catalog = catalog;
    }
</code></pre><p>The <code>parse(...)</code> function will return the list of steps given a string.</p>
<pre tabindex=0><code>
    @Override
    public ParseResult&lt;Step&gt; deepParse(String input);
        if (!appliesTo(input)) {
            throw new IllegalArgumentException(
                    &quot;Wrong format provided. This is not parseable by us&quot;);
        }

        ...
    }

</code></pre><p>The <code>ParseResult&lt;T></code> class is an auxiliary class that returns both a list of steps and some metadata that may be helpful to decorate the source code. For example, the name of the integration, or some dependencies.</p>
<pre tabindex=0><code>    class ParseResult&lt;T&gt; {
        private List&lt;T&gt; steps;
        private Map&lt;String, Object&gt; metadata;
        ...
    }
</code></pre><p>And the <code>appliesTo(...)</code> function will also check that the CRD provided is valid for this service.</p>
<pre tabindex=0><code>    @Override
    public boolean appliesTo(final String yaml) {
        return yaml.contains(&quot;kind: KameletBinding&quot;);
    }
</code></pre><p>Note that this <code>appliesTo</code> function is the one that decides if you will be able to parse the source code or not. If this function returns <code>true</code>, the function <code>parse</code> must return a valid list of steps.</p>
<h3 id=stepcatalogparser-optional>StepCatalogParser (Optional)</h3>
<p>Your DSL may have specific steps that needs to be added to the catalog. To add those steps to the general catalog, you have to provide an <code>@ApplicationScoped</code> implementation of the <code>StepCatalogParser</code>:</p>
<pre tabindex=0><code>@ApplicationScoped
public final class KameletParseCatalog implements StepCatalogParser {

    private KameletParseCatalog() {

    }

    @Override
    public ParseCatalog&lt;Step&gt; getParser(final String url, final String tag) {
        ParseCatalog&lt;Step&gt; parseCatalog = new GitParseCatalog&lt;&gt;(url, tag);
        parseCatalog.setFileVisitor(new KameletFileProcessor());
        return parseCatalog;
    }


    @Override
    public ParseCatalog&lt;Step&gt; getParser(final String url) {
        ParseCatalog&lt;Step&gt; parseCatalog = new JarParseCatalog&lt;&gt;(url);
        parseCatalog.setFileVisitor(new KameletFileProcessor());
        return parseCatalog;
    }
}
</code></pre><p>Both GitParseCatalog and JarParseCatalog are helper classes that will access the git repository or zip file defined and use a FileVisitor to process the files encountered on them. You don&rsquo;t have to use them in your implementation. The only requirement is to return a <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/metadata/src/main/java/io/kaoto/backend/metadata/ParseCatalog.java>ParseCatalog</a> that will be called when warming up the catalog steps.</p>
<p>On this case, the <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/kamelet-support/src/main/java/io/kaoto/backend/metadata/parser/step/kamelet/KameletFileProcessor.java>KameletFileProcessor</a> is an auxiliary class that extends <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/metadata/src/main/java/io/kaoto/backend/metadata/parser/YamlProcessFile.java>YamlProcessFile</a> to process Kamelet metadata definitions. You can use any FileProcessor that you find suitable to your use-case.</p>
<p>If you don&rsquo;t require any FileProcessor, you can leave that property empty. The only mandatory implementation detail about the ParseCatalog instance returned by your StepCatalogParser is that the returned ParseCatalog <code>parse()</code> function returns a list of Steps. You can implement your own ParseCatalog class.</p>
<p>It may be you are using your own kind of steps, specific for your DSL.</p>
</div>
</div>
</div>
</div>
</section>
<footer class="bg-dark footer-section">
<div class=section>
<div class=container>
<div class=row>
<div class=col-md-4>
<h5 class=text-light>Email</h5>
<p class="text-white paragraph-lg font-secondary"><a href=mailto:hellokaoto@gmail.com>hellokaoto@gmail.com</a></p>
</div>
<div class=col-md-4>
<h5 class=text-light>Source Code</h5>
<p class="text-white paragraph-lg font-secondary"><a href=https://github.com/KaotoIO>https://github.com/KaotoIO</a></p>
</div>
<div class=col-md-4>
<h5 class=text-light>Twitter</h5>
<p class="text-white paragraph-lg font-secondary"><a href=https://www.twitter.com/KaotoIO>https://www.twitter.com/KaotoIO</a></p>
</div>
</div>
</div>
</div>
<div class="footer-bottom border-top text-center border-dark py-5">
<p class="mb-0 text-light">Copyright © 2021 a Theme by <a href=https://gethugothemes.com>Gethugothemes</a></p>
</div>
</footer>
<script src=https://kaoto.io/plugins/jQuery/jquery.min.js></script>
<script src=https://kaoto.io/plugins/bootstrap/bootstrap.min.js></script>
<script src=https://kaoto.io/plugins/slick/slick.min.js></script>
<script src=https://kaoto.io/plugins/shuffle/shuffle.min.js></script>
<script src=https://kaoto.io/js/script.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js></script>
<div id=js-cookie-box class="cookie-box cookie-box-hide">
This site uses cookies. By continuing to use this website, you agree to their use. <span id=js-cookie-button class="btn btn-sm btn-primary ml-2">I Accept</span>
</div>
<script>(function(c){const a=document.getElementById('js-cookie-box'),b=document.getElementById('js-cookie-button');Cookies.get('cookie-box')||(a.classList.remove('cookie-box-hide'),b.onclick=function(){Cookies.set('cookie-box',!0,{expires:2}),a.classList.add('cookie-box-hide')})})(jQuery)</script>
<style>.cookie-box{position:fixed;left:0;right:0;bottom:0;text-align:center;z-index:9999;padding:1rem 2rem;background:#474747;transition:all .75s cubic-bezier(.19,1,.22,1);color:#fdfdfd}.cookie-box-hide{display:none}</style>
</body>
</html>